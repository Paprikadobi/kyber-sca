import pyftdi.serialext as ft

from os import urandom
from crypto import *

if __name__ == '__main__':
    # from pyftdi.ftdi import Ftdi
    # Ftdi.show_devices()
    s = ft.serial_for_url('ftdi://ftdi:2232:FT15CC7B/1', baudrate=3000000)

    k = 2

    while True:
        pk = bytes.fromhex('126329c5c3bd88a5ae78f61831102f00d085a379cf138956eac5ba7d7692fcb5315d0960c5a24b58621d29246d2fbb5c01951072e6931548262c5b41b4788bd2173438cc0d64262205873cc03752e6c14fc0e62655f4539242a7cc38c24b0079a260a389907eb4a844f0c4492f1a1d59573cda417833e87ec3297662328cc9d817888876213a9a5a4471f3d90a8cac98821ba72da249f22c0b6c038d1f50b26ac4186215c602534504790a53433a62a9ac86054c7543a8371c185524be38709588ec10fc33034da633abe68a486a6a0364aeb35438d998702633c0b842ade53b5bf2cc053ef47fea67018f4700330223234ca2210bb3f331860132894f509d1ce128760b27de67aeee3b04f88a604215772977aa2be398df596753ac20327037c48a81b182b803370738c344df1acf23c359b94b1bd366c895088071868ee5f90194b84defdbadb045643b7b8228ba7425310727e54a5fc56345bbb264a89097a68cc939124bf806654895a94c6898e2010bc40a474533fc44b30c9405aa1cc9b5d264514a08f7907e379a98af47bd7d3a829fb8afca8166b24687533527d675b6ae069963e47ddeb65116402acbcc85afd8bce06a10c30bbffca63627e1cb16a64ca0ca6c55b8c702390a19c6279d59b31404264201cd28b722d0f987c6a3917e48c153d551e0d5207dbc95e056b188520d1ef63990f661fe7ba29e2466378c04f0551be704a26205cc2bb1b66ffcc19d8183092090909477f93a73360a8c3483a67ba066272ca27fc1080435730afbce34f9bc9f244ed4a5af865baac82a91fb27c88f2454ee2458ba5656556b3ac84b63df18208f381d34fa326abb9e1070ad79d5590f45bda6478b07325f2f59b3c390784e860c624a837aba24075b6a25d0292606a4e5f38eed375d2e6c7fc36613be345c717014e7203541507af1549da6e2cfd8f6b7950612760449048714b7f65ebfa6500fe93d1b9a400dc11697952934088379cabdc1fa73dfa2c0d3963006397abf414e8db35785f9058f8baefc5ab3a38659a006400913a1c4667d18436bd91c0628a611c2f7a6f47c26e4062bf0277575f67e7689340d11eb352090c8229a915d436a0d33baec9bfb9f2d2eef')
        sk = bytes.fromhex('c4d23133d92147616be17935c7238c371b64e3864a8bd6c36f96b9bab3a2f20060c71b4e57733babe4b3fbc3ca74f67f5b4a32cd22b89cc218c62a75cc39c27bb88aa1a1c6559c5e405a7fee7cb577b817d0c40b3f45956d7aa35704c13b65510fd1b3784733c7c85e0610a7ebf5c47f221a88569641632a14e2b4609a813fe8c975153c2ce0a32672250909830eeb0f1db441d39669c288012d062e3a533e0b3831555baabe89998ed284ffdc9ee960291edb63b16491162241e2276afbd4a05f2642716511fe630d7d3a8bfba10eb5002f87a09767c084e83720397837c1f78c48daadd91294a4e45c065c9c30f4329125abd5567a67223f601c1b7f68348b634c5b1a709683930bfa148e4a4323c174dacccacb743010848158b893a0d71109f59801fa7d6f8105587b5c6f74888e29b743233f62c0b200e11baa157855a19c9b699f01fbb22eb7114d63906bc677d27b945dbc8f57489ed3890094c607cb0488cee9acd609693510649ed2b054b50d0c3b72acfb4e47e67c29b81eea65038221ba65345b7ca220546391d893200831a0a3b4636a305050187e08db8744dc4db64cb2082808c3d29a2a8824edbb38201614bb20219ff7c8f4bb63569b1bf0b02c4cd7caacd4c5a8d612853a058485055294994f450e085c7a0213062f002497cba66c503dc1f29920e272678573339428e7cc6cd263cbd67879c5735788b80376b81fc5919bdc169bc2c996685284b7cc2009e4cdad16921af54e6319328572b70af3b5df362b9ae4461b7b3b2a2472873185be0c1034c49f35120f8fea6becc8be527b699c982c902046d3fa19700c120bd3542af7cb67018301d995fc6a35ba7245a626cdbbc97f4c8a2ac654a04f4799f1978c95f999f8d75c3ff68120855c44c9630507b1a2f1a322c929cfc29b6031a7c94595f80698797b29fc12753b716a8e4340f39231233637f8807b211908c108ce86233947424d4b075fd37b4bee649b65a7681543bb23c26bbf834d65b8cd14f07dbcab7190e846847234e6e0b4362949d558c729c8122fc0b39583419dfb582027c7b67c71a6f687e07227126329c5c3bd88a5ae78f61831102f00d085a379cf138956eac5ba7d7692fcb5315d0960c5a24b58621d29246d2fbb5c01951072e6931548262c5b41b4788bd2173438cc0d64262205873cc03752e6c14fc0e62655f4539242a7cc38c24b0079a260a389907eb4a844f0c4492f1a1d59573cda417833e87ec3297662328cc9d817888876213a9a5a4471f3d90a8cac98821ba72da249f22c0b6c038d1f50b26ac4186215c602534504790a53433a62a9ac86054c7543a8371c185524be38709588ec10fc33034da633abe68a486a6a0364aeb35438d998702633c0b842ade53b5bf2cc053ef47fea67018f4700330223234ca2210bb3f331860132894f509d1ce128760b27de67aeee3b04f88a604215772977aa2be398df596753ac20327037c48a81b182b803370738c344df1acf23c359b94b1bd366c895088071868ee5f90194b84defdbadb045643b7b8228ba7425310727e54a5fc56345bbb264a89097a68cc939124bf806654895a94c6898e2010bc40a474533fc44b30c9405aa1cc9b5d264514a08f7907e379a98af47bd7d3a829fb8afca8166b24687533527d675b6ae069963e47ddeb65116402acbcc85afd8bce06a10c30bbffca63627e1cb16a64ca0ca6c55b8c702390a19c6279d59b31404264201cd28b722d0f987c6a3917e48c153d551e0d5207dbc95e056b188520d1ef63990f661fe7ba29e2466378c04f0551be704a26205cc2bb1b66ffcc19d8183092090909477f93a73360a8c3483a67ba066272ca27fc1080435730afbce34f9bc9f244ed4a5af865baac82a91fb27c88f2454ee2458ba5656556b3ac84b63df18208f381d34fa326abb9e1070ad79d5590f45bda6478b07325f2f59b3c390784e860c624a837aba24075b6a25d0292606a4e5f38eed375d2e6c7fc36613be345c717014e7203541507af1549da6e2cfd8f6b7950612760449048714b7f65ebfa6500fe93d1b9a400dc11697952934088379cabdc1fa73dfa2c0d3963006397abf414e8db35785f9058f8baefc5ab3a38659a006400913a1c4667d18436bd91c0628a611c2f7a6f47c26e4062bf0277575f67e7689340d11eb352090c8229a915d436a0d33baec9bfb9f2d2eefd833f20b7c1147af501573c83e1afec71c3f8d7b02e291d6ec3d0b537e00b0caa206e8ffe4c06e12b7f4b80fcc61cd977c675e29b06fb349ffcf35d5a972387f')

        m = bytes.fromhex('75b73db4243c5bb0e559d9f129710e7fc79cb79cac11fc956351e92027fb20ae')

        c = bytes.fromhex('ae70eff8f0b96ad7a3e64c98c8d0a89f79911dbb8e4a6ebe68538f0f1a3815701788176530743cc162e82eec06175bde13f8a8c4ab034e7e37baa29027fad5563098ff37d4621482125107de202263155178df5ac901819c665afca94e83accf2830d94567933284c5f2542e5d614596cb9298c05deba68b64681bc5142b8850094d44358f636eb487ff8d372632b85718c5862562076e8bc8417c6f461f1663fd94d4156bef5649afa098a13b3788a75b0a75264954409f88bffa262550a66a71879ac202ac6631f5e8252dd46cbf7f2b626075045357ea7f1c3d0e1846968a4fc7c9d4e7aec30b54d8f51482147521a6cea1ed58079c9374d67f279ad3b234c8ea393ed8020ae3e37572701fe7d00bf0664f6605036ec8352fae6697a5255e697ade9790a523f0f99bf9f8c68ceaa38a1dd3a84ce6cdacd263cd7e757b1fe99c03ad198bd9a70845d1aa9119602e801250a275b6415870207174710e676555b982d02f0e39f7b6588bec5b42b2c340b1f5498449b76eec5c832715563d0b55e5b1628bbf0cb87b8636dd208dc650216c0efe801b9820f09b05c809156f24e092bf6d324208401bfc5ff9f98a87d7bea25b34aa31a20c99588911a55bcff1c4f42021ebb9b62ee3a033c1e0999ae10a0bc2226aba8c8e2f65b03a3e4e3892d6bbfdb3a0f77e42809cd833865453d2d910328bca75bc9d73ad625358c8b002d8c05d0373f747ce170eb40942c23232a9384858a5739a5ce389f3ee10d2d65d6c455ae5bd57fe3e923a277c331b227d60784085ca9f21c35af6eb25e9740f19512bf9f51b90ddd56aad84143185c32331fe2724b1fa9858b8ea0a29f0d4fecf713130addbbf79754d748a7075132260b8dd8e44cb69727d1b793d762911499235de3c627273e8ca8d8cec7b35a036924deeb8c109d861ef18e08390a4a68ce1e20a3b31f2e76bbe8b33d213e09755cee10a342567c4ff685dbca60e3a08cbf82e3962afff35be8215aba9ab3686bf6d089754ecce790aff2dd8aeffffdbab0fd3cb853ce196fd86fcc04b8ff5d864f0d92dc2df7b6f24f8ecf81728f7048effc3')

        K2 = kyber_kem_dec(s, sk, c, k)

        print(K2.hex())

    s.close()